<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>foo</title>
    <link rel="stylesheet" href="https://static.datakortet.no/font/fa470/css/font-awesome.css">

    <script crossorigin="anonymous" src="https://polyfill.io/v3/polyfill.js?features=fetch,es5,es6,es7,Object.entries,Object.fromEntries,Element.prototype.append,DocumentFragment.prototype.append,DocumentFragment.prototype.prepend&flags=gated"></script>
    <script crossorigin="anonymous" src="https://unpkg.com/@webcomponents/webcomponentsjs@2.2.6/webcomponents-bundle.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-migrate-3.0.1.min.js" integrity="sha256-F0O1TmEa4I8N24nY0bya59eP6svWcshqX1uzwaWC4F4=" crossorigin="anonymous"></script>
    <script src="https://js.pusher.com/7.0/pusher.min.js"></script>
    
    <!--dk.js proper/core-->
    <script DEBUG LOGLEVEL="4" crossorigin="anonymous" name="dkk" src="js/dkdj.min.js"></script>
    <!--END dkdj SECTION-->

    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap-theme.min.css">

    <style>
    </style>

</head>
<body>
    <div class="container">
        <h1 id="id-title">
            hello world     <dk-icon style="color:hotpink" value="paw:2x,fw"></dk-icon>
        </h1>
        <div id="dtatbl" class="table "></div>
    
<!--        <div style="outline: 2px solid green; padding:4px;margin:4px;">-->
<!--            <input id="dval" type="text" value="42">-->
<!--        </div>-->
<!--        <div id="input-box" style="outline: 2px solid red; padding:4px;margin:8px 4px;"></div>-->

        <dk-panel>
            <h1>Hello world</h1>

            <div>Inside div..</div>
        </dk-panel>
        
        <dk-panel>
            <h1>Hello world</h1>
            
            Look ma, no tags..
        </dk-panel>

        <div style="display:inline-block;border:1px solid blue">
            9900 = <dk-load url="https://cache.norsktest.no/ajax/poststed/9900/">
                       LOADING...
                   </dk-load>
        </div>

        <div id="tree1" style="margin:5px;"></div>
    </div>
    
    <script>
        // const dvref = new dk.ValueRef({pk:0, field:''});
        // dk.on(dvref, 'value-changed', v => $('#dval').val(v));
        const ds = dk.data.DataSet.create({
            datasource: [
                {project: 'first', work: '1:03:57'},
                {project: 'aTiktok', work: '2:44:57'},
                {project: 'bGenerelt NT', work: '1:03:57'},
                {project: 'cTiktok', work: '2:44:57'},
                {project: 'dGenerelt NT', work: '1:03:57'},
                {project: 'eTiktok', work: '2:44:57'},
                {project: 'fGenerelt NT', work: '1:03:58'},
                {project: 'gTiktok', work: '2:44:58'},
                {project: 'hGenerelt NT', work: '1:03:58'},
                {project: 'iTiktok', work: '2:44:58'},
                {project: 'jGenerelt NT', work: '1:03:58'},
                {project: 'kTiktok', work: '2:44:58'},
                {project: 'last', work: '1:06:43'}
            ],
            pagesize: 6,
            orphans: 1
        });
        // dk.on(ds, 'fetch-info', d => console.log("DS:FETCH-info:", d));
        // dk.on(ds, 'fetch-data', d => console.log("DS:FETCH-data:", d));
        // console.log("Declaring resultset");

        const dt = dk.ResultSet.create_inside("#dtatbl", {
            add_widget: false,
            download_widget: false,
            
            dataset: ds, 
            construct_table: function (location, downloadwidget, ds) {
                // console.info("HTML:construct_table");
                return dk.DataTable.create_on(location, {
                    classes: ['table table-bordered table-hover table-condensed'],
                    download: downloadwidget,
                    table_data: ds,
                    columns: {
                        project: {label: 'Prosjekt'},
                        work: {label: 'Arbeid'}
                    }
                });
            }
        });
        dt.ready(() => {
            dk.on(dt.table.table_data, 'fetch-data', d => console.log("FETCHED:", d));
        });

        const tds = dk.tree.JSonDataSource.create({
            "depth": 2,
            "height": 4,
            "cache": {
                "d329": {
                    "kind": "department",
                    "name": "Bar3",
                    "parent": "c57",
                    "id": "d329",
                    "path": [
                        "c57", "d329"
                    ],
                    "root": "c57",
                    "children": []
                },
                "d328": {
                    "kind": "department",
                    "name": "Bar2",
                    "parent": "c57",
                    "id": "d328",
                    "path": [
                        "c57", "d328"
                    ],
                    "root": "c57",
                    "children": []
                },
                "d3291": {
                    "kind": "department",
                    "name": "Foo 4",
                    "parent": "c56",
                    "id": "d3291",
                    "path": [
                        "c56", "d3291"
                    ],
                    "root": "c56",
                    "children": []
                },
                "d3289": {
                    "kind": "department",
                    "name": "Foo 5",
                    "parent": "c56",
                    "id": "d3289",
                    "path": [
                        "c56", "d3289"
                    ],
                    "root": "c56",
                    "children": []
                },
                "d32899": {"kind": "department", "name": "Foo 5", "parent": "c56", "id": "d32899", "path": ["c56", "d32899"], "root": "c56", "children": []},
                "d328999": {"kind": "department", "name": "Foo 5", "parent": "c56", "id": "d328999", "path": ["c56", "d328999"], "root": "c56", "children": []},
                "c56": {
                    "kind": "company",
                    "name": "Foo1",
                    "parent": null,
                    "id": "c56",
                    "path": [
                        "c56"
                    ],
                    "root": "c56",
                    "children": ['d3291', 'd3289', 'd32899', 'd328999']
                },
                "c55": {"kind": "company", "name": "Bar4", "parent": null, "id": "c55", "path": ["c55"], "root": "c55", "children": []},
                "c54": {"kind": "company", "name": "Bar5", "parent": null, "id": "c54", "path": ["c54"], "root": "c54", "children": []},
                "c53": {"kind": "company", "name": "Bar6", "parent": null, "id": "c53", "path": ["c53"], "root": "c53", "children": []},
                "c52": {"kind": "company", "name": "Bar7", "parent": null, "id": "c52", "path": ["c52"], "root": "c52", "children": []},
                "c57": {"kind": "company", "name": "Bar1", "parent": null, "id": "c57", "path": ["c57"], "root": "c57", "children": ['d329', 'd328']}
            },
            "roots": ['c57', 'c56', 'c55', 'c54', 'c53', 'c52']
        });

        dk.TreeWidget.create_inside('#tree1', {
            initial_collapse: false,
            tree_data: tds,
            // selectable: ['department'],
            // multiselect: false
        });

        // const w = dk.forms.TextInputWidget.create_inside('#input-box', {
        //     datasource: dt.table_data.value_ref({pk:2, field:'project'})
        // });


        // const dt = dk.DataTable.create_on('#dtatbl', {
        //     datasource: [
        //         {project: 'Generelt NT', work: '1:03:57'},
        //         {project: 'Tiktok',      work: '2:44:57'},
        //         {project: 'FOO-support', work: '1:06:43'},
        //     ],
        //     columns: {
        //         pk: {},
        //         project: {},
        //         work: {},
        //     }
        // });
        
        // dk.on(w, 'value-changed', newval => console.log("ON:W:...set-value...:", newval));
        // console.log("W:DATASOURCE:", w.datasource);
        // console.log("W:DATASOURCE:dataset", w.datasource.ds);
    </script>
</body>
</html>
