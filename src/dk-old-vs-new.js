/* eslint-disable no-console */

import {set_difference} from "./lifecycle/set-ops";
import is from "./is";


export default function old_vs_new(dk) {

    function list_contents(obj, pth) {
        function _list_contents(obj, path, result) {
            function is_object(item, pth, k) {
                return (
                    !['globals', '$', '_', '__super__', 'append_to', 'create', 'create_on', 
                        'create_inside', 'toString', 'extend', 'next_widget_id',
                        '__class__', 'DEFINES', 'FN'
                    ].includes(k) &&
                    pth !== 'dk.dkjstag.tag' &&
                    !k.match(/[?0-9@]/) &&
                    item[k] &&
                    is.isObject(item[k])); // && item[k].name !== "SubClass"); // && !is.isFunction(item[k]));
            }

            const roots = Object.keys(obj).filter(k => is_object(obj, path, k));
            // console.log('found roots:',path, roots);
            roots.forEach(r => {
                const subpath = `${path}.${r}`;
                result.push(subpath);
                _list_contents(obj[r], subpath, result);
            });
            return result;
        }
        return _list_contents(obj, obj.name || pth, []);
    }
    
    const originaldk = new Set(
        [
            "dk.Class",
            "dk.ColumnDef",
            "dk.DataFilter",
            "dk.DataGrid",
            "dk.DataTable",
            "dk.DataTableLayout",
            "dk.Date",
            "dk.DateTime",
            "dk.Duration",
            "dk.PagerWidget",
            "dk.PostnrLookupWidget",
            "dk.ResultSet",
            "dk.SearchWidget",
            "dk.SortDirection",
            "dk.TableCell",
            "dk.TableHeader",
            "dk.TableRow",
            "dk.VDataTable",
            "dk.Widget",
            "dk.after",
            "dk.ajax",
            "dk.all",
            "dk.bind",
            "dk.combine",
            "dk.core",
            "dk.core.counter",
            "dk.core.help",
            "dk.core.lifecycle",
            "dk.core.lifecycle.bind",
            "dk.core.lifecycle.initialize",
            "dk.core.lifecycle.ready",
            "dk.core.text",
            "dk.core.text.count",
            "dk.core.text.dedent",
            "dk.count",
            "dk.counter",
            "dk.ctor_apply",
            "dk.cursor",
            "dk.data",
            "dk.data.AjaxDataSource",
            "dk.data.ArraySource",
            "dk.data.Data",
            "dk.data.DataPage",
            "dk.data.DataSet",
            "dk.data.JSONDataSource",
            "dk.data.Source",
            "dk.data.datatype",
            "dk.data.datatype.Date",
            "dk.data.datatype.DateTime",
            "dk.data.datatype.Duration",
            "dk.data.datatype._datatypes",
            "dk.data.format",
            "dk.data.format.format",
            "dk.data.format.format.bool",
            "dk.data.format.format.no_date",
            "dk.data.format.format.no_datetime",
            "dk.data.format.format.percent",
            "dk.data.format.format.twodigits",
            "dk.data.format.format.value",
            "dk.data.format.format_value",
            "dk.data.jason",
            "dk.data.jason.parse",
            "dk.data.jason.postparse",
            "dk.data.jason.stringify",
            "dk.debug",
            "dk.dedent",
            "dk.dir",
            "dk.dkjstag",
            "dk.dkjstag.tag",
            "dk.dom",
            "dk.dom.DomItem",
            "dk.dom.Template",
            "dk.dom._block_elements",
            "dk.dom._inline_elements",
            "dk.dom._self_closing_elements",
            "dk.dom.dkitem",
            "dk.dom.equal",
            "dk.dom.find",
            "dk.dom.here",
            "dk.dom.id",
            "dk.dom.is_block",
            "dk.dom.is_inline",
            "dk.dom.is_self_closing",
            "dk.dom.is_tag",
            "dk.dom.one",
            "dk.error",
            "dk.filter",
            "dk.filter.DataFilter",
            "dk.find",
            "dk.format",
            "dk.format.bool",
            "dk.format.no_date",
            "dk.format.no_datetime",
            "dk.format.percent",
            "dk.format.twodigits",
            "dk.format.value",
            "dk.format_value",
            "dk.forms",
            "dk.forms.CheckboxSelectWidget",
            "dk.forms.DurationWidget",
            "dk.forms.InputWidget",
            "dk.forms.RadioInputWidget",
            "dk.forms.RadioSelectWidget",
            "dk.forms.SelectWidget",
            "dk.forms.TextInputWidget",
            "dk.forms.TextWidget",
            "dk.forms.TriboolWidget",
            "dk.forms.validators",
            "dk.forms.validators.email",
            "dk.forms.validators.persnr",
            "dk.forms.validators.phone",
            "dk.forms.widgetmap",
            "dk.forms.widgetmap.boolean",
            "dk.forms.widgetmap.number",
            "dk.forms.widgetmap.string",
            "dk.help",
            "dk.here",
            "dk.icon",
            "dk.import",
            "dk.import._loadstate",
            "dk.import._loadstate.font-awesome.css",
            "dk.import._loadstate.font-awesome.css.item",
            "dk.import.css",
            "dk.import.js",
            "dk.info",
            "dk.initialize",
            "dk.jason",
            "dk.jason.parse",
            "dk.jason.postparse",
            "dk.jason.stringify",
            "dk.json",
            "dk.layout",
            "dk.layout.Layout",
            "dk.layout.ResultsetLayout",
            "dk.layout.TableLayout",
            "dk.layout.TableRowLayout",
            "dk.log",
            "dk.merge",
            "dk.namespace",
            "dk.on",
            "dk.one",
            "dk.panel",
            "dk.panel.PanelWidget",
            "dk.parse_uri",
            "dk.publish",
            "dk.ready",
            "dk.subscribe",
            "dk.sys",
            "dk.sys.ctor_apply",
            "dk.sys.mcall",
            "dk.sys.throttle",
            "dk.table",
            "dk.table.ColumnDef",
            "dk.table.DataGrid",
            "dk.table.DataTable",
            "dk.table.DataTableLayout",
            "dk.table.PagerWidget",
            "dk.table.ResultSet",
            "dk.table.SearchWidget",
            "dk.table.SortDirection",
            "dk.table.TableCell",
            "dk.table.TableHeader",
            "dk.table.TableRow",
            "dk.table.VDataTable",
            "dk.traverse",
            "dk.tree",
            "dk.tree.Generation",
            "dk.tree.NodeList",
            "dk.tree.SelectTable",
            "dk.tree.data",
            "dk.tree.data.AjaxDataSource",
            "dk.tree.data.Data",
            "dk.tree.data.DataSource",
            "dk.tree.data.Forrest",
            "dk.tree.data.JSonDataSource",
            "dk.tree.data.Leaf",
            "dk.tree.data.Tree",
            "dk.tree.list",
            "dk.tree.list.Leaf",
            "dk.tree.list.Tree",
            "dk.tree.list.TreeWidget",
            "dk.unsorted",
            "dk.unsorted.PostnrLookupWidget",
            "dk.unsorted.cursor",
            "dk.unsorted.icons",
            "dk.unsorted.icons.icon",
            "dk.unsorted.icons.icons",
            // "dk.unsorted.icons.icons.IconLibrary",
            "dk.update",
            "dk.warn",
            "dk.web",
            "dk.web.browser",
            "dk.web.browser.browser",
            "dk.web.client",
            "dk.web.client.ajax",
            "dk.web.client.json",
            "dk.web.cookie",
            "dk.web.cookie.get",
            "dk.web.cookie.set",
            "dk.web.css",
            "dk.web.css.getattr",
            "dk.web.css.maxheight",
            "dk.web.css.rotate",
            "dk.web.css.setattr",
            "dk.web.css.tilt",
            "dk.web.css.unrotate",
            "dk.web.dom",
            "dk.web.dom.DomItem",
            "dk.web.dom.Template",
            "dk.web.dom._block_elements",
            "dk.web.dom._inline_elements",
            "dk.web.dom._self_closing_elements",
            "dk.web.dom.dkitem",
            "dk.web.dom.equal",
            "dk.web.dom.find",
            "dk.web.dom.here",
            "dk.web.dom.id",
            "dk.web.dom.is_block",
            "dk.web.dom.is_inline",
            "dk.web.dom.is_self_closing",
            "dk.web.dom.is_tag",
            "dk.web.dom.one",
            "dk.web.html",
            "dk.web.html.tidy",
            "dk.web.state",
            "dk.web.state.State",
            "dk.web.state.storage",
            "dk.web.state.storage.cookie",
            "dk.web.state.storage.hash",
            "dk.web.state.storage.local",
            "dk.web.state.storage.session",
            "dk.web.uri",
            "dk.web.uri.parse",
            "dk.widget",
            "dk.widget.Widget",
            "dk.widget.page",
            "dk.widget.page._bind_q",
            "dk.widget.page._bindings",
            "dk.widget.page._cache_widget_init",
            "dk.widget.page._sockets",
            "dk.widget.page._widget_q",
            "dk.widget.page.bind",
            "dk.widget.page.create_widget",
            "dk.widget.page.hash",
            "dk.widget.page.hash.engine",
            "dk.widget.page.hash.state",
            "dk.widget.page.initialize",
            "dk.widget.page.ready",
            "dk.widget.page.reflow",
            "dk.widget.page.refresh",
            "dk.widget.page.refresh_widget",
            "dk.widget.page.state",
            "dk.widget.page.state.css",
            "dk.widget.page.state.js",
            "dk.widget.page.state.path",
            "dk.widget.page.storagekey",
            "dk.widget.page.trigger",
            "dk.widget.page.triggers",
            "dk.widget.page.unload",
            "dk.widget.page.widget_list",
            "dk.widget.page.widget_refresh_q",
            "dk.widget.page.widgets",
            "dk.widget.widgetmap",
            "dk.widget.widgetmap.add",
            "dk.widget.widgetmap.get",
            "dk.widget.widgetmap.wmap",
            "dk.widget.widgetmap.wmap.CheckboxSelectWidget",
            "dk.widget.widgetmap.wmap.DataFilter",
            "dk.widget.widgetmap.wmap.DataGridRow",
            "dk.widget.widgetmap.wmap.DurationWidget",
            "dk.widget.widgetmap.wmap.InputWidget",
            "dk.widget.widgetmap.wmap.PagerWidget",
            "dk.widget.widgetmap.wmap.PanelWidget",
            "dk.widget.widgetmap.wmap.RadioInputWidget",
            "dk.widget.widgetmap.wmap.RadioSelectWidget",
            "dk.widget.widgetmap.wmap.SelectWidget",
            "dk.widget.widgetmap.wmap.SortDirection",
            "dk.widget.widgetmap.wmap.TableCell",
            "dk.widget.widgetmap.wmap.TableHeader",
            "dk.widget.widgetmap.wmap.TableRow",
            "dk.widget.widgetmap.wmap.TextInputWidget",
            "dk.widget.widgetmap.wmap.TriboolWidget",
            "dk.widget.widgetmap.wmap.datagrid",
            "dk.widget.widgetmap.wmap.datatable",
            "dk.widget.widgetmap.wmap.dk-tree-generation",
            "dk.widget.widgetmap.wmap.dk-tree-list-leaf",
            "dk.widget.widgetmap.wmap.dk-tree-list-tree",
            "dk.widget.widgetmap.wmap.dktree",
            "dk.widget.widgetmap.wmap.postnr-lookup-widget",
            "dk.widget.widgetmap.wmap.resultset",
            "dk.widget.widgetmap.wmap.search",
            "dk.widget.widgetmap.wmap.tree-node",
            "dk.widget.widgetmap.wmap.treeselect",
            "dk.widget.widgetmap.wmap.treeselect-nodelist",
            "dk.widget.widgetmap.wmap.vTableColumn",
            "dk.widget.widgetmap.wmap.vdatatable"
        ]
    
    );

    const dkattrs = new Set(list_contents(dk));
    console.info("STARTING:", Array.from(originaldk).length);
    console.warn("MISSING:", Array.from(set_difference(originaldk, dkattrs)).sort());
    console.warn("EXTRA:", Array.from(set_difference(dkattrs, originaldk)).sort());
}
